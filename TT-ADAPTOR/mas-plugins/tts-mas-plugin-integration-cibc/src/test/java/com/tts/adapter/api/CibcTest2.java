package com.tts.adapter.api;

import org.springframework.core.io.ClassPathResource;

import com.google.protobuf.TextFormat;
import com.tts.fix.support.FixApplicationProperties;
import com.tts.message.market.FullBookStruct.FullBook;
import com.tts.plugin.adapter.impl.cibc.dialect.CibcResponseDialectHelper;
import com.tts.plugin.adapter.impl.cibc.validate.CIBCSpotPublishValidator;

import quickfix.DataDictionary;

public class CibcTest2 {



	public static void main(String[] args) throws Exception {
		FixApplicationProperties p = new FixApplicationProperties();
		p.setProperty("spot.vwap", "true");
		
		String qMsg = "8=FIXT.1.19=206635=W34=74052449=CIBC_OLYMPIA_MKD_UAT52=20170601-07:29:29.04056=OLYMPIA_MKD_UAT115=OLYMPIA128=OLYMPIA55=EURCAD167=FXSPOT262=EURCAD.SPOT.721000000000004803268=16269=0278=J3E3OEQU1404502270=1.51469271=500000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51469269=1278=J3E3OEQU1404502270=1.51597271=500000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51597269=0278=J3E3OEQU1404502270=1.51469271=1000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51469269=1278=J3E3OEQU1404502270=1.51597271=1000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51597269=0278=J3E3OEQU1404502270=1.51466271=3000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51466269=1278=J3E3OEQU1404502270=1.51604271=3000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51604269=0278=J3E3OEQU1404502270=1.51465271=5000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51465269=1278=J3E3OEQU1404502270=1.51607271=5000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51607269=0278=J3E3OEQU1404502270=1.51456271=10000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51456269=1278=J3E3OEQU1404502270=1.5163271=10000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.5163269=0278=J3E3OEQU1404502270=1.51456271=20000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51456269=1278=J3E3OEQU1404502270=1.51638271=20000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51638269=0278=J3E3OEQU1404502270=1.51447271=30000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51447269=1278=J3E3OEQU1404502270=1.51655271=30000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.51655269=0278=J3E3OEQU1404502270=0271=50000000272=20170601276=B299=J3E3OEQU140450263=064=201706051026=0269=1278=J3E3OEQU1404502270=1.51657271=50000000272=20170601276=A299=J3E3OEQU140450263=064=201706051026=1.5165710=127";

		ClassPathResource cpr = new ClassPathResource("CIBCFIX50.xml");
      DataDictionary dd = new DataDictionary( cpr.getFile().getAbsolutePath());

      dd.setCheckUnorderedGroupFields( true );
      quickfix.fix50.MarketDataSnapshotFullRefresh messageEURCAD = new quickfix.fix50.MarketDataSnapshotFullRefresh();
      messageEURCAD.fromString( qMsg, dd, true );

      
      CibcResponseDialectHelper h = new CibcResponseDialectHelper();
      FullBook.Builder fbEURCAD = FullBook.newBuilder();
      h.convertAndUpdate(messageEURCAD, fbEURCAD);

      System.out.println(TextFormat.shortDebugString(fbEURCAD));
      CIBCSpotPublishValidator v = new CIBCSpotPublishValidator();
      fbEURCAD = v.validate(fbEURCAD);
      System.out.println(TextFormat.shortDebugString(fbEURCAD));

	}
}
